on: [push]
name: newtmptask1



jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    env:
      ResourceGroupName: deep123
      ResourceGroupLocation: "eastus"
    steps:
      - uses: actions/checkout@master
      - uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
      - uses: Azure/CLI@v1
        with:
          inlineScript: |
            #!/bin/bash
            pwd
            az aks get-credentials --resource-group deep123 --name muffin25
            cat $HOME/.kube/config | base64   
            export KUBECONFIG=~/.kube/config:~/github/workspace

        
      - uses: actions/checkout@master
      - name: deploy to cluster
        uses: steebchen/kubectl@v2.0.0
        with: # defaults to latest kubectl binary version
          config: ${{ secrets.KUBE_CONFIG_DATA }}
          command: set image --record deployment/my-app container=${{ github.repository }}:${{ github.sha }}
      - name: verify deployment
        uses: steebchen/kubectl@v2.0.0
        with:
          config: ${{ secrets.KUBE_CONFIG_DATA }}
          version: v1.21.0 # specify kubectl binary version explicitly
          command: kubectl create namespace ratingapp
        

            
